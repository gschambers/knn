var kNN=this.kNN||{};kNN.util=(function(c,d){var a;a={inherit:function b(f,e){f.prototype=new e();f.prototype.constructor=f}};return a})(this);kNN.feature={};kNN.feature.Feature=(function(c,d){var b;b=function b(e){this.key=e};b.prototype.calcDistance=function a(f,e){throw {name:"NotImplementedError",message:"Feature#calcDistance must be implemented by a subclass"}};return b})(this);kNN.feature.Numerical=(function(d,f){var b;b=function b(g){kNN.feature.Feature.call(this,g);this.minValue=Infinity;this.maxValue=-Infinity};kNN.util.inherit(b,kNN.feature.Feature);b.prototype.checkValue=function c(g){if(g<this.minValue){this.minValue=g}if(g>this.maxValue){this.maxValue=g}};b.prototype.getRange=function e(){return this.maxValue-this.minValue};b.prototype.calcDistance=function a(h,g){return(h.get(this.key)-g.get(this.key))/this.getRange()};return b})(this);kNN.feature.Category=(function(b,e){var d;d=function d(f,g){kNN.feature.Feature.call(this,f);this.values=[];this.weight=g||1};kNN.util.inherit(d,kNN.feature.Feature);d.prototype.checkValue=function c(h){var g,f;g=false;f=this.values.length;while(f--){if(this.values[f]===h){g=true;break}}if(!g){this.values.push(h)}};d.prototype.calcDistance=function a(g,f){return g.get(key)===f.get(key)?0:this.weight/this.values.length};return d})(this);kNN.Point=(function(d,e){var c;c=function c(h,i){var g;this.category=h;this.values={};for(g in i){this.set(g,i[g])}};c.prototype.get=function a(g){return this.values[g]};c.prototype.set=function f(g,h){this.values[g]=h};c.prototype.keys=function b(){var g,h;if(Object.keys){return Object.keys(this.values)}h=[];for(g in this.values){h.push(g)}return h};return c})(this);kNN.Model=(function(d,g){var f,c,a,e;c=function c(i){var h;h={};i.forEach(function(j){j.keys().forEach(function(l){var k;if(!h.hasOwnProperty(l)){switch(typeof j.get(l)){case"number":k=new kNN.feature.Numerical(l);break;case"string":k=new kNN.feature.Category(l);break;default:return}h[l]=k}h[l].checkValue(j.get(l))})});return h};e=function e(h){return h.sort(function(j,i){return j[1]<i[1]?-1:1})};a=function a(p,q,s){var o,k,l,h,r,m,j;o={};l=0;m=0;for(;m<p;m++){j=s[m][0];if(!o.hasOwnProperty(j.category)){o[j.category]=0}o[j.category]+=1}for(r in o){if(o[r]===l){if(1&Math.random()*100>>0){h=true}}if(h||o[r]>l){k=r;l=o[r];h=false}}return k};f=function f(i){var h;h=this;this.points=[];i.forEach(function(j){h.points.push(new kNN.Point(j[0],j[1]))});this.features=c(this.points)};f.prototype.classify=function b(h,i){var l,k,j;j=this;k=[];this.points.forEach(function(n){var m;l=0;for(m in j.features){l+=Math.pow(j.features[m].calcDistance(h,n),2)}l=Math.sqrt(l);k.push([n,l])});k=e(k);return a(i,h,k)};return f})(this);